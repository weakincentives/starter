# Debug Bundles

This directory stores debug bundles generated by the trivia agent during execution.

## What are Debug Bundles?

Debug bundles are self-contained execution artifacts that capture everything needed to understand and reproduce an agent session:

- Session state and conversation history
- Filesystem snapshots (workspace contents)
- Logs and traces
- Metrics and timing information
- Request/response payloads

## Enabling Debug Bundles

Set the `TRIVIA_DEBUG_BUNDLES_DIR` environment variable to this directory:

```bash
export TRIVIA_DEBUG_BUNDLES_DIR=$(pwd)/debug_bundles
```

Or use the Makefile target which sets this automatically:

```bash
make agent
```

## Inspecting Bundles

Debug bundles are saved as `.zip` files. WINK provides two ways to inspect them:

### For Humans: Debug Server

Start an interactive debug server with a web UI:

```bash
wink debug debug_bundles/<bundle-name>.zip
```

This opens a browser-based interface for exploring the bundle.

### For Agents: SQL Queries

Use `wink query` for programmatic SQL-based exploration:

```bash
# Show schema and available tables
wink query debug_bundles/<bundle-name>.zip --schema

# Run SQL queries
wink query debug_bundles/<bundle-name>.zip "SELECT * FROM errors"

# Get formatted table output
wink query debug_bundles/<bundle-name>.zip "SELECT * FROM tool_calls" --table
```

### Manual Extraction

You can also extract the raw bundle contents:

```bash
unzip debug_bundles/<bundle-name>.zip -d /tmp/bundle
```

## Bundle Contents

Each bundle contains structured data that gets loaded into SQLite tables:

| Table | Description |
|-------|-------------|
| `manifest` | Bundle ID, status, timestamps |
| `logs` | All log entries with event names and context |
| `tool_calls` | Tool invocations with params, results, timing |
| `errors` | Aggregated errors from logs and failed tools |
| `session_slices` | Session state items |
| `files` | Workspace files with paths and content |
| `metrics` | Token usage and timing metrics |

Raw file structure inside the zip:

```
<bundle>.zip
├── manifest.json     # Bundle metadata
├── config.json       # Configuration
├── metrics.json      # Token usage and timing
├── run_context.json  # Request/session/trace IDs
├── logs/             # Execution logs (JSONL)
├── session/          # Session state snapshots
└── filesystem/       # Workspace files
```

## Cleanup

Bundle files are excluded from git. To clean up old bundles:

```bash
make clean-bundles
```
